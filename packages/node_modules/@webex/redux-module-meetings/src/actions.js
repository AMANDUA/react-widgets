export const JOIN_MEETING = 'meetings/JOIN_MEETING';
export const STORE_MEETING = 'meetings/STORE_MEETING';

function storeMeeting({destinationType, destinationId, meeting}) {
  return {
    type: STORE_MEETING,
    payload: {
      destinationType,
      destinationId,
      meeting
    }
  };
}

function joinMeeting(meeting) {
  return {
    type: JOIN_MEETING,
    payload: {
      meeting
    }
  };
}

export function createAndJoinMeeting({destinationType, destinationId}, sdkInstance) {
  return (dispatch) => sdkInstance.meetings.create(destinationId)
    .then((meeting) => {
      dispatch(storeMeeting({destinationId, destinationType, meeting}));

      // TODO: handle meeting destroyed event

      return meeting.join().then(() => {
        dispatch(joinMeeting(meeting));

        // TODO: Bind Events and add media

        return meeting;
      });
    });
}
