import * as AdaptiveCard from 'adaptivecards';

import {attachmentType} from './constants';

function getCardConfig(card, sparkInstance) {
  try {
    return JSON.parse(card);
  }
  catch (err) {
    sparkInstance.logger.error('Failed to parse Adaptive Card', err);
  }

  return null;
}

export function getAdaptiveCard(cards, displayName, sparkInstance) {
  // Parse the card for rendering
  try {
    const cardConfig = getCardConfig(cards[0]);
    const adaptiveCard = new AdaptiveCard.AdaptiveCard();

    adaptiveCard.parse(cardConfig);

    return adaptiveCard.render();
  }
  catch (err) {
    sparkInstance.logger.error('Failed to parse Adaptive Card', err);
  }

  return displayName;
}

export function hasAdaptiveCard(cards, sparkInstance) {
  if (cards.length > 0 && Array.isArray(cards)) {
    const cardConfig = getCardConfig(cards[0], sparkInstance);

    return cardConfig !== null && cardConfig.type === attachmentType;
  }

  return false;
}

